@page "/Product/{id:guid}"
@model ProductModel
@{
            Layout = "_Layout";
    ViewData["Title"] = "Product Details";
}

<link href="~/Product/product.css" rel="stylesheet" />


@if (Model.Product == null)
{
    <h2>Product not found</h2>
}
else
{
    <h2>@Model.Product.Name</h2>

    <img src="data:image/png;base64,@Model.Product.Image" alt="@Model.Product.Name" width="300" />


    <p><strong>Description:</strong> @Model.Product.Description</p>
    <p><strong>Brand:</strong> @Model.Product.Brand</p>
    <p><strong>Start Price:</strong> @Model.Product.StartPrice.ToString("C")</p>
    <p><strong>Current Bid:</strong> @Model.Product.currentbid?.ToString("C") ?? "No bids yet"</p>
    <p><strong>End of Auction:</strong> @Model.Product.EndOfAuction.ToString("f")</p>

    <h4>Bid History</h4>
    @if (Model.Product.BidHistory?.Any() == true)
    {
        <ul>
            @foreach (var bid in Model.Product.BidHistory.OrderByDescending(b => b.BidTime))
            {
                <li>
                    Bidder ID: @bid.BidderId — Amount: @bid.BidAmount.ToString("C") — Time: @bid.BidTime.ToString("g")
                </li>
            }
        </ul>
    }
    else
    {
        <p>No bids yet.</p>
    }

    @if (User.Identity != null && User.Identity.IsAuthenticated)
    {
        <h4>Place a Bid</h4>

        <form method="post">
            <div class="mb-3">
                <label for="bidAmount" class="form-label">Your Bid</label>
                <input type="number" step="0.01" name="BidAmount" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Place Bid</button>
        </form>

        @if (Model.ErrorMessage != null)
        {
            <div class="alert alert-danger mt-2">@Model.ErrorMessage</div>
        }
        @if (Model.SuccessMessage != null)
        {
            <div class="alert alert-success mt-2">@Model.SuccessMessage</div>
        }
    }
    else
    {
        <p><strong>Log in to place a bid.</strong></p>
    }

    <a class="btn btn-link mt-3" href="/auction/Catalog">Back to Catalog</a>
}
