@page "/Product/{id:guid}"
@model ProductModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Product Details";
}

<link href="~/Product/product.css" rel="stylesheet" />

@if (Model.Product == null)
{
    <h2>Product not found</h2>
}
else
{
    <h2>@Model.Product.Name</h2>

    <img src="data:image/png;base64,@Model.Product.Image" alt="@Model.Product.Name" width="300" />

    <p><strong>Beskrivelse:</strong> @Model.Product.Description</p>
    <p><strong>Brand:</strong> @Model.Product.Brand</p>
    <p><strong>Start Pris:</strong> @Model.Product.StartPrice.ToString("C") Kroner</p>
    <p><strong>Højeste Bud:</strong> @(Model.Product.currentbid?.ToString("C") ?? "Ingen bud endnu")</p>
    <p><strong>Auktionens slutdato:</strong> @Model.Product.EndOfAuction.ToString("f")</p>


    <h4>Bud Historik</h4>

    @if (Model.Product.BidHistory?.Any() == true)
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Bidder ID</th>
                    <th>Bid Amount</th>
                    <th>Bid Time</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var bid in Model.Product.BidHistory.OrderByDescending(b => b.BidTime))
                {
                    <tr>
                        <td>@bid.CustomerNumber</td>
                        <td>@bid.BidAmount.ToString("C")</td>
                        <td>@(bid.BidTime?.ToString("g") ?? "No bid time")</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    @if (User.Identity != null && User.Identity.IsAuthenticated)
    {
        <h4>Placer et Bud</h4>

        <form method="post">
            <div class="mb-3">
                <label for="bidAmount" class="form-label">Dit Bud</label>
                <input type="number" step="0.01" name="BidAmount" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Placer Bud</button>
        </form>

        @if (Model.ErrorMessage != null)
        {
            <div class="alert alert-danger mt-2">@Model.ErrorMessage</div>
        }
        @if (Model.SuccessMessage != null)
        {

            <div class="alert alert-success mt-2">@Model.SuccessMessage</div>
        }
    }
    else
    {
        <p>
            <a class="btn btn-link mt-3" href="/auction/login">Log ind for at placere et bud</a>
        </p>
    }


    <a class="btn btn-link mt-3" href="/auction/Catalog">Tilbage til Kataloget</a>
}
